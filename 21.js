const input = `...................................................................................................................................
.##.....#.........#........#...#......#.#.#..#..#......#....#..............#..............#........#...#.#....#...#....##.#.....#..
...........#..#.....##.#.##...........#.##.......#.....................##....#.#..#....#.#......##.....#...#....#....#.....#.......
.....#.#..................##.....#.#...#............#.#...........................#..............#......#.......#.##...............
.........#...#.........#.##......#.#...#..#.#.#......#.#..................##.#...#...........#..............#....#....#....#.......
..##.......#.#...#.#.#......#.#..##.##.#.........#..#.............#..........#...##.###................#.#.........................
..............##......#...........#.#....#.#......#...##.......#.............#........#....#...#..#.#.........#.....#...#...#..#...
......##..#.#.###..#.......#............#...#.....#.#..........................#.##....##....#.#....#.#.....#.#....#.....#.........
.........#...#.#..#.....##.....#.#....#........#..#..........#..#.................#...................#.....#....#..........#......
.##........................#.........#....#....................#................#....#.#..#..##.#..#......#..#..............#......
..#.#.......##..#..#.................#..............................#.#.........##...............#..#.#.....#.....##.........##....
.......#.#..##.###....#.##...#.#..#.#.##........##...............................#......#............#.....#...#.##....#.#.....#...
.................#......#............#..#....................#....#.....##.......#.......#..#............#.#....#.##.#.............
..#...#..##.....#.....#....#...#.#..#..........#..........#..##.#..##..#...........#.......#......##....#.#........#........#..###.
.#......#................#.#.#.........##.....#...........##....#...#.....#...............###..#....##......#..#....##.......#.#...
..#.....#........#....#....#.###..#.#........#....................#.....##..........#.............#.#.....#...........#............
.#.##...............#.....#....#....#.......#..................#...#.......##.........#.......................#...#.........#...#..
.#.........#.........###.....#.##......#...................#....#.....##.###................#..............#.......#..#.#..........
.........#...#......#..###.....##........#...........#.......#....#.....##.................##.....#.#....#....##.#..#....#.........
.#.................#....#......#...............................#.....#.........................#...#........#....#.................
...#........#...............##.#..#..............#.....#...#.#....#.....#..................#....#.....####...#........##...........
.....................#...#...#.......#.................#.#...##.#....#.....#...##.................#....###.#....#...#........#.....
..........#.........#.........#..#....................##.......#..#......#.................#...#..............#.#..#....#..........
.#.#..##.........#.....##..#...#................##....#......#.........#..#.#.#...............#.......#.....................#.#....
....#.#...#.#........#.......#.#...#...............##..............#............##.................#....#....#.##.....#.#........#.
..#.....#......#........#........#...........#....................#..#........#.....................#.#.#.................##.....#.
...#..##........#.....#...........#.........#..#.#............##.....#.#..............#........#........#..#.....#.................
......#......#....#....#....#........................#......#..##...##....#........##...........................#...#...#...#......
.#........#..#...#...#...##...##...........###.......#.........#....#.....#.#..#.........#........#...#...#.#........#.............
...#...............#...#................#....#.##..........#.......#...#..#......#....##.......................#.#..##.......#...#.
.#....#.....#.......###..##...............##....#..#..............###..#..#.....#....#.....................#..#....###.#...##....#.
...#........#...#.......................#..........#.....###..###.............##.........#...........#.#..#..#..##.......#....#....
..#....##......#........###.................#...............#...........#...........................................#.........#....
......##....#.#.#.....................#............#...###.........#....#......#....###..................#.....#...................
...#.................#.#..............#.#.#.........#........#.....##......#..#......#.........#..............#####............###.
.................#...#......................#...#............#.....##.#....#..#....#...#.##.................##.................#...
........#.....................................#.#.#.........#..#...#...............#.......#.....#............#...........#........
.......#.#....#........#...............###............#........#........#....#..#..........................#.....#..#...#....#.....
..#...#...........#.............#...........###.....#..#...........##...#...........#...#.......#..........#......##..###......#...
.#..........#.#...##............#.##...#.......#.#.............#...#.#...##.............#....#....#.........#.#...#...#.......#.##.
............#.#...................#......#....#..##....#.#.#.#.#......#..........#......#.#..............................#.....#...
..#..#.........#...##........#.#.........#..#...#...........#.............#.#.....#.....#....##.....##.............................
.....#........#.................#.#.......##..#........#.......#......##........#......#......##...............##...........#...#..
.#..........................#..##..#.....#...#...#........#...##..#.....##.##........#..#........#...#...........#.................
..#.#......#...##.........#......#..........#.............#...#..........#.#.......#........#...#..#................##.............
..#.....#.#..#............#.......................#.#...#...#.......#.....#.....#..#.......##...#..................#.............#.
.......#.##..#.............#...##...#..#..##............#..#.##......#......#..#..#.#.#......#......#..#...........#.........#.....
..........##...................#................##....#...........#.....................#.....#................................#...
...#.#.......#...........#...#....#..#.#...#.....#..#........#......#......#.#.#.........#.......#....###.#...........#............
.#..#.......#..............#.....#..#........#...#......#......#........#..........................##........#.....................
......#.#.#............#.....#..........#...#...#....#...#.##..#...#...#......#........#.#.#.#.....##.......##...................#.
.......#...............#...#...................#.....#..........#.....##.................#.#.........##..###.......................
.#.#..............##...#...#.....#.........#...........#.....###....#...........#.#.......##..##.......#.#.........................
...#..#.........#..#...#..............##.#......#..........#.......#...#....#..#.......................#.#.......#.............#...
...#...#.............#......#.....#............#..##............#...#.#.#.##.......#....##........#........##..#..#.........#......
................#..#.............#......##.#.##...#...#....#...........#...#.....#.....#..#.#.#....##...#...................##..#..
.......................#..#.......##....#..#.#........#........#..#..###....#..........#..#..#........##..#...................#....
..#...........#......#.####..........#.#.......#........#.............#........#...#...#......#....#...#...#.......................
..#........#.................#.##.#...#....#.....#....#...#........#.....#.##.........#.#........#......#.##.#....#.##.#........#..
................#.#..............#........#.###.#.#..................................#.##.....#.#.##.#...#...#.#...##..............
...............#.....#...........###....#.#...#....##......#..#.....#....................#..#..........#....#.........#............
..............##...#....#.#.##...#....#........###.....#.#..#..#..........#.........##...#......#.#...#...#.#...#..#...#..#........
..........#.......#.............#.................#...............#.....##......##...........#..##..#......#......#..#.#...........
........#...#........#..............#...............#.#..#..#.................###.......#......#....#......#.#..#..#...............
........###...#...#...#.#......#....#...#...........#.....#................#...........###..#.............#....#...................
.................................................................S.................................................................
...........#...#..#.#.........#...##....................##.#.###.........#...........##...............#....................#.......
......#.................#..........#.........#..##....#......##.......#.#.............#...............#.###......#.#......#........
................#.##.#......##........#....#.....#.......................#......#.......#................#####........#.#..........
.........#..#...#.....#...#....#..........#.#......#..#....#..#.....#.#...#...............#...###.#.#.#.#..#..#..#.#..#...#........
............#...###................................#..#.#...#......#..............#........#......#.#.....#.#.......#..............
..#.......#.......#.#.#.#........#....#.......#..#.....#.....#.....#...........#.......#..#.......#.......#....###......#..........
.....................................#...#..........#.....#....#..........#............#........#......####...........#............
.##...........#....#...#......#....##....##.#......#......#.......#..##.....#.....#.........#....#..#............#....#............
...................##..............##....###......#.#....##........#..........#..#.##......#.......#.........#.....................
..##..#.......#..........................#.#..#.........#.......#.......#.....#..#......#...........#...........#.###........#.....
..................#.#....###....####.#.......##.....#....#.....................................#...#...#......#....................
.###....#..............#.......#.##.##....#...###....#.##.#....##...............#.#..........#...........#.##.##...................
.....#.#.............#............#......##..#.........#.#..#...#.................#....#...#.......#...#..................#........
....#..#..........#.#.......##...#.....#...##.#....#.....#..#.......#..........#......................#..#................#.##.#...
.#...#...............#...#.....#...#..#...#....#.#...#.#...#.......#...#.......#......................###..#.................##....
......#...#.........#.#......#...##...##.....#...#...#...##...#......#...#....#####..........#...............#...........#.#...#.#.
.#..........##...........................#...#....#..#............#.........#......#....#........#.....#.....#.................#.#.
..##..#......#................#.......#.....#.......#.##....##..#......#.....#.............#....#..#...##.......................##.
......#........#.........#.#....##.........##..............#..#.....#.#...#.......#........#...........................#.......#.#.
.......#......##.............#...##.......#...#..#.........##..##.....##.#.....#.......#..................#........#.#....#.....#..
..#.......#.................#........#....#....##.##..........#.#......##..#...#......#...#........###.#...............#......##...
..........#.#..................###.#..............#...#.....#.#...#........#.#....#..#.......#..#.#.#........................#.....
..#..........#.#............#.#.#......##...............#.#..#..#.###.....#..#..##.##............##.....................#...#.#....
...#.#..##.......#..........##.#.......#..#..........#.......#..#..........#..#.#...#.......#............................##....#...
.#..#.............#.##..........#...#...#.##...##.......#...#........##.#..#............##..##...................#......#.....#....
.......................................##....#.........#.....................................#...#..........#.#....#........#......
....#......#.#...................#.#.......#.#.......#..#.#.#.....#...........#.#.##.......##.....#...........##........##....#.##.
.........#.........##............#......#.##.##....##.......#..............#.##........##.#......#........#......###..........##.#.
......#............#.#.......................#...#......#.#.....#...#.........#.#.#....#..................#.......##.......#.......
.....#..#....#..#.........#.......#.#....#....#.#..........#......#..#.....#.......#.#.......#..............#....#.................
....#.................#..#.........#....#......#.#....#.........#.........#..#...#....#.##......................#........#.#..#.#..
.#..#..............#.......#........#.....#......#..................#.#...#...#.#...#......#..........##.#.#.#.............#.......
.#............#.#....##..................##..#.....#.....#................##..............##.#..................#.##..#....#..#.#..
......#.....##...##...##...#..............#.......##..#......##...#.....#....#.#.#........#...........#...#....#.........#.........
...#....#..#.....#.......#.................................#..........#....#....#.......#...........#.#..#..#...........##...#..#..
............#...........#..#..............#...#.........#..............#..........#.#..#..........##......##..#....................
....#.#....#..#.......#......#..........................#.#.#.#.#.................#....................#.....###.......#......#....
.....#.....#..#............#.#..#......................#....#.......#..#....#..........................#.#.#......#.##.#...........
.......#..............#........#............#....#......#.#..#..............#.#.##.#.....................#....#............#..#.##.
...#........................#....#..................#...#.#.###...#...#......#..##...##.......#.#.....#..........#..###..........#.
....##....#....#.......#..##........#..........#.....#.#....#..#...#...........................#..#.......#.....#......#...#.......
.....#...##.#...#...##...#.....................#.#....#..#.....#................#................#..#.#......................#.....
........#...#.....##.##..#........#...##.........#..#.#.............##........#............#..###.....#.....#............#.........
.#........##.....##....#...#...........#........................#.##.##.........##...............#..#...#...........#.......##.#...
.......#................#.#........................##......#........#......#.....#............#........#.....#.#...#...#.#.....#...
.......#.....#.#....#....#....###.....#...........#.....#.....#...##....##.....#..........#..#.#......#..###.#.........#...#...##..
...#.#........#....#..#.....#..#......#.#.##..........##........#...#.......................#..#......#......#.....#..........#....
..###.....#.........##.....#....#.##.....#..........#....##.........#..#...............#.............#.##.....#......#..#..........
...#..##...................##.#.....#.###....#................#............#.........#...........................#.......#.#.......
.#....#.........................#...#.........#..........#..#.........#...#...........#.................#.............#.....##..##.
...............#.....#...#....#...#......#................#.......##...............#..#.............#........#....#.##.#...........
....#............#...#............#....#......#.........###....#........#.........#.....#.#.##....#...#...............##..##.......
.....#..#..................#....#...........#.#.#.......................#.........#.......#####..##....#.............#...#......##.
.....#..#..#..................###......#....#....##...................#.#.......#..##....#.....#..........#.#....##.#.#..#......#..
.......##.........###..................#..........#................###..............##.##.#.#.#....#................#...#..#.#..#..
.#..#.........###.......#.....#......#.......#.................#..............##...#........#....#..#.....##.......#.....#.........
..........#.....##.........#.........#.###.....#.#..............#....#...................................##...............#......#.
.#...##..#...#.....##....#.#.#..........##.#................................#......##......#.........#..##..##.........##........#.
......#.#.....#...........##.#..#.....#.......#........#....................#........##.#...#.....##...#.###..#..#....#........#...
....##...........##.....#...............##.#...#..#........................#......#........#.##.......#....#..#...#.........#..##..
....####.#....#.#.......##...###....#...##..#.#...................................#.......##....##.#.#.................#..##....##.
........#.........#....#.......#.......#.#...........#..................#..#..#...##...#.....##....##.#..#.##.........#............
.#............#..#.#.....#......#.##.#.#.#..#....##..#..............................#....#........#.....#..........#...#......#....
............#.....#.#........##.#.....#......#.#.........#...............#.....#.#.#.##......#....#.#.....#.....................#..
...................................................................................................................................`;
const example1 = `...........
.....###.#.
.###.##..#.
..#.#...#..
....#.#....
.##..S####.
.##..#...#.
.......##..
.##.#.####.
.##..##.##.
...........`;

const dirs = [
  [0, 1],
  [1, 0],
  [0, -1],
  [-1, 0]
];


(async function main () {
  for (let [name, rawData] of [['example1', example1], ['input', input]]) {
    const garden = rawData.split('\n').map(line => line.split(''))
    const n = garden.length
    const half = n / 2 >> 0
    const startY = half
    const startX = half

    for (let part2 of [false, true]) {
      let ans = 0
      let steps = part2
        ? name == 'input' ? 26501365 : 5000
        : name == 'input' ? 64 : 6

      console.log('---------')
      console.log('|       |')
      console.log('| START |')
      console.log('|       |')
      console.log('---------')
      console.time(`start ${name} ${part2 ? 'part 2' : 'part 1'}`)

      function fill (y, x, d) {
        const plots = [[y, x, d]]
        const ans = new Set()
        const seen = new Set()

        while (plots.length) {
          let [y, x, d] = plots.shift()

          if (d%2 == 0) ans.add(`${y},${x}`)
          if (d == 0) continue

          for (let [dy, dx] of dirs) {
            const ny = y + dy
            const nx = x + dx

            if (
              ny < 0 || ny >= n ||
              nx < 0 || nx >= n ||
              garden[ny][nx] == '#' ||
              seen.has(`${ny},${nx}`)
            ) continue

            seen.add(`${ny},${nx}`)

            plots.push([ny, nx, d - 1])
          }
        }

        return ans.size
      }

      if (part2) {
        const width = (steps / n >> 0) - 1

        const odd_count = ((width / 2 >> 0) * 2 + 1) ** 2
        const even_count = (((width + 1) / 2 >> 0) * 2) ** 2
        const fill_odd = fill(startY, startX, 2*n + 1)
        const fill_even = fill(startY, startX, 2*n)

        const corner_t = fill(n - 1, startX, n - 1)
        const corner_b = fill(0, startX, n - 1)
        const corner_l = fill(startY, 0, n - 1)
        const corner_r = fill(startY, n - 1, n - 1)

        const small_tl = fill(0, 0, half - 1)
        const small_tr = fill(0, n - 1, half - 1)
        const small_bl = fill(n - 1, 0, half - 1)
        const small_br = fill(n - 1, n - 1, half - 1)

        const large_tl = fill(0, 0, n + half - 1)
        const large_tr = fill(0, n - 1, n + half - 1)
        const large_bl = fill(n - 1, 0, n + half - 1)
        const large_br = fill(n - 1, n - 1, n + half - 1)

        ans = fill_odd * odd_count + fill_even * even_count +
          corner_t + corner_b + corner_l + corner_r +
          (width + 1) * (small_tl + small_tr + small_bl + small_br) +
          width * (large_tl + large_tr + large_bl + large_br)
      } else {
        ans = fill(startY, startX, steps)
      }

      console.log(ans);
      console.timeEnd(`start ${name} ${part2 ? 'part 2' : 'part 1'}`)
    }
  }
})()
